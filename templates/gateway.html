{% extends 'base.html' %}

{% block title %}Gateway{% endblock title %}

{% block content %}

    {% if user.is_authenticated %}

        Hi {{ user.username }}!

        {% if user.role == "warmupper" %}

            <a href="{% url 'w-assigned-email-addresses' %}">Assigned Email Addresses</a>
            <a href="{% url 'w-email-engagement-and-renumeration' %}">Email Engagement & Renumeration</a>

        {% elif user.role == "manager" %}

            <!--MENUBAR-->

            <a href="{% url 'm-manage-users' %}">Manage Users</a>
            <a href="{% url 'm-manage-email-addresses' %}">Manage Email Addresses</a>
            <a href="{% url 'm-calculate-warmupper-email-engagement' %}">Calculate Warmupper Email Engagement</a>
            <a href="{% url 'm-warmupper-email-engagement-and-renumeration' %}">Warmupper Email Engagement And Renumeration</a>

            <!--STATS-->
            <div>
                <canvas id="stats_chart" height="60px"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <script>

                // Labels
                const labels = [{% for engagement in engagement_by_warmupper%}"{{engagement.warmupper__username}}",{%endfor%}];

                // Data
                const data = {
                  labels: labels,
                  datasets: [
                  {
                    label: 'Opens',
                    data: [{% for engagement in engagement_by_warmupper%}"{{engagement.opens_sum}}",{%endfor%}],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgb(255, 99, 132)',
                    borderWidth: 1.5
                  },
                  {
                    label: 'Clicks',
                    data: [{% for engagement in engagement_by_warmupper%}"{{engagement.clicks_sum}}",{%endfor%}],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgb(54, 162, 235)',
                    borderWidth: 1.5
                  }
                ]
                };

                // Config
                const config = {
                    type: 'bar',
                    data: data,
                    options: {
                      scales: {
                        y: {
                          beginAtZero: true
                        }
                      },
                      barPercentage: 0.8,
                      categoryPercentage: 0.1
                    },
                  };

                // New Chart
                const myChart = new Chart(document.getElementById('stats_chart'), config);
                
            </script>


            <!--ACTIONS-->
            <ul>
                {% for action in manager_actions %}
                    <li>Approve or reject <i>{{ action.action_details.name }}</i> for {{ action.action_details.sender.username }}.</li>
                    <form method="post">
                        {% csrf_token %}
                        <button class="actionacceptbutton" data-action-id="{{action.id}}" style="background-color: {% if action.status == 'accepted' %}green{% endif %}">Accept</button>
                        <button class="actionrejectbutton" data-action-id="{{action.id}}" style="background-color: {% if action.status == 'rejected' %}red{% endif %}">Reject</button>
                        <input type="text" placeholder="comment" name="commentfield" class="commentfield" data-action-id="{{action.id}}" value="{{action.comment}}">
                        <button type="submit" class="commentsubmitbutton" data-action-id={{action.id}}>Submit</button>
                    </form>
                    <br><br>
                {% endfor %}
            </ul>

        {% elif user.role == "sender" %}

            <a href="{% url 's-create-email-list' %}">Create Email List</a>
            <a href="{% url 's-manage-email-lists' %}">Manage Email Lists</a>

            
            <ul>
                {% for email_list in this_users_email_lists %}
                    <li>{{ email_list }}</li>
                {% endfor %}
            </ul>



        {% endif %}

        <p><a href="{% url 'logout' %}">Log Out</a></p>

    {% else %}

        <p>You are not logged in.</p>
        <a href="{% url 'login' %}">Log In</a><br>
    {% endif %}

{% endblock content %}